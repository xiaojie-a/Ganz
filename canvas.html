<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/szjp.css">
    <script src="./js/szjp.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>待还款清单</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            color: #333;
            line-height: 1.6;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .container {
            max-width: 1920px;
            margin: 0 auto;
            padding: 20px;
        }

        header {

            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background: #ffffff;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }


        .section {
            max-width: 350px;
            flex-basis: 100%;
            background: white;
            height: 350px;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
        }

        .section h2 {
            color: #ff6b6b;
            border-bottom: 2px solid #ffecec;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }



        footer {
            margin-bottom: 15px;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #fad0c4 0%, #ff9a9e 100%);
            border-radius: 15px;
            color: white;
        }


        .love-counter {
            font-size: 2em;
            margin: 10px 0;

        }


        #ls {
            float: right;
            overflow: auto;
            height: 240px;
            width: 170px;
            font-size: 1.5rem;
        }

        #dc {
            display: flex;
            align-items: center;

        }

        .battery {
            height: 60px;
            background-color: #eee;
            border-radius: 5px;
            width: 50%;
            float: left;

        }

        .battery-level {
            width: 0%;
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 5px;
            transition: width 0.5s ease;
        }


        .battery-percentage {
            margin-left: 10px;
            font-weight: bold;
            font-size: 2rem;
            color: #000000;
        }

        #ann {
            background: linear-gradient(to right, #CDAED8, #f2c9f3);
            transition: width 0.5s ease;
            border-radius: 15px;
            margin-bottom: 30px;
            padding: 15px;
            height: 240px;
            width: 140px;
            transition: all 0.3s ease;

        }

        #ann:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: scale(1.02);
        }

        /* 响应式设计 */
        @media (max-width: 992px) {
            .sections-container {
                flex-direction: column;
            }

            .section {
                width: 100%;
                max-width: 100%;
            }
        }

        .sections-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 30px;
        }

        #L:hover {
            cursor: pointer;
        }

        #R:hover {
            cursor: pointer;
        }

        #L {
            transition: color 0.5s ease-in-out;
            border-radius: 50px;
            width: 40%;
            height: 50px;
            position: fixed;
            top: 70px;
            /* 相对于父元素顶部偏移 50% */
            left: 10%;
            /* 相对于父元素左侧偏移 50% */
            z-index: 20;
            text-align: center;
            line-height: 50px;
            color: #ffffff;
        }

        #R {
            transition: color 0.5s ease-in-out;
            border-radius: 50px;
            width: 40%;
            height: 50px;
            position: fixed;
            top: 70px;
            /* 相对于父元素顶部偏移 50% */
            right: 10%;
            /* 相对于父元素左侧偏移 50% */
            z-index: 20;
            text-align: center;
            line-height: 50px;
        }

        #dhl {
            width: 80%;
            height: 50px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            background: #ffffff;
            position: fixed;
            top: 70px;
            /* 相对于父元素顶部偏移 50% */
            left: 10%;
            /* 相对于父元素左侧偏移 50% */
            z-index: 10;
        }

        #gd {
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, #CDAED8, #f2c9f3);
            border-radius: 50px;
            transition: margin-left 0.5s ease-in-out;
            margin-left: 0%;
        }

        #nr {
            width: 100%;

        }

        .search-input {
            margin-top: 20px;
            flex: 1;
            padding: 12px 30px;
            width: 100%;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
        }

        .search-input:focus {

            border-color: #f2c9f3;
            box-shadow: 0 0 8px #CDAED8;
        }

        #container {
            filter: blur(20px);
            transition: all 0.3s ease;
        }


        p {
            margin-bottom: 25px;
            font-size: 18px;
            line-height: 1.6;
        }

        .btn {
            padding: 12px 25px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-close {
            background: #e74c3c;
        }

        .btn-close:hover {
            background: #c0392b;
        }

        /* 全屏覆盖层样式 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.20);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .overlay-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            position: relative;
            transform: translateY(50px);
            transition: transform 0.5s ease;
        }

        .overlay.active .overlay-content {
            transform: translateY(0);
        }

        #xsfw {
            margin-left: 15px;
        }
    </style>
</head>

<body>
    <div class="overlay" id="overlay">
        <div class="overlay-content">
            <button class="close-btn" id="closeOverlay">&times;</button>
            <h3>正在努力核验数据……</h3>
            <p>当此页面超过60s未自动关闭，请检查网络后刷新整个页面。</p>



        </div>
    </div>

    <div id="app">

        <!-- 模态框（Modal） -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title" id="myModalLabel">
                            {{ modalTitle }}
                        </h4>
                    </div>
                    <div class="modal-body">
                        <div id="L" @click="SJ()">{{l}}</div>
                        <div id="R" @click="DN()">{{r}}</div>
                        <div id="dhl">
                            <div id="gd"></div>
                        </div>
                        <input id="input" type="text" style="margin-top: 60px;" class="search-input"
                            placeholder="请输入备注！！！">
                        <div id="containers" class="containers">
                            <div class="display">
                                <div class="input-value">123.45</div>
                                <div class="placeholder">请输入金额</div>
                            </div>

                            <div class="keyboard">
                                <button class="key number">1</button>
                                <button class="key number">2</button>
                                <button class="key number">3</button>
                                <button class="key number">4</button>
                                <button class="key number">5</button>
                                <button class="key number">6</button>
                                <button class="key number">7</button>
                                <button class="key number">8</button>
                                <button class="key number">9</button>
                                <button class="key operation">.</button>
                                <button class="key number zero">0</button>
                                <button class="key backspace">⌫</button>
                                <button class="key confirm">确认</button>
                            </div>
                        </div>

                        <div class="instructions">
                            点击数字按钮或使用键盘输入数字
                        </div>

                        <div id="nr"></div>
                    </div>

                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>


        <div id="container" class="container">

            <footer id="myFooter">
                <div class="love-counter">
                    总负债￥{{parseFloat((parseFloat(amount || 0) + parseFloat(amountmt || 0) + parseFloat(amountwx ||
                    0)).toFixed(2))+3000}}<br>
                    总收入￥{{sry}}
                </div>
                <p id="opText">今天你吃了么</p>
            </footer>

            <div class="sections-container">
                <section class="section">
                    <h2>今日入账</h2>
                    <div id="ann" style="float: left" @click="showModal('sry')">
                        <h2 style="float: left">{{rsr}}</h2>
                        <div style="padding: 15%;"><img src="%E6%8C%87%E7%BA%B9.png"
                                style="width: 70px;margin-top: 40%"></div>
                    </div>
                    <div id="ls">
                        <template v-for="(item, index) in srys.slice().reverse()">
                            <div id="lsjl">{{item.created_at}}</div>
                            <div id="lsjl" style="color: red;">{{item.historical}}</div>

                        </template>

                    </div>

                </section>

                <section class="section">
                    <h2>京东白条</h2>
                    <div id="ann" style="float: left" @click="showModal('alipay')">
                        <h2 style="float: left">{{amount}}</h2>
                        <div style="padding: 15%;"><img src="%E6%8C%87%E7%BA%B9.png"
                                style="width: 70px;margin-top: 40%"></div>
                    </div>
                    <div id="ls">
                        <template v-for="(item, index) in items.slice().reverse()">
                            <div id="lsjl">{{item.created_at}}</div>
                            <div id="lsjl" style="color: red;">{{item.historical}}</div>

                        </template>

                    </div>

                </section>

                <section class="section">
                    <h2>微信分付款</h2>
                    <div id="ann" style="float: left" @click="showModal('wechat')">
                        <h2 style="float: left">{{amountwx}}</h2>
                        <div style="padding: 15%;"><img src="%E6%8C%87%E7%BA%B9.png"
                                style="width: 70px;margin-top: 40%"></div>
                    </div>
                    <div id="ls">
                        <template v-for="(item, index) in itemswx.slice().reverse()">
                            <div id="lsjl">{{item.created_at}}</div>
                            <div id="lsjl" style="color: red;">{{item.historical}}</div>

                        </template>

                    </div>
                </section>

                <section class="section">
                    <h2>美团月付</h2>

                    <div id="ann" style="float: left" @click="showModal('meituan')">
                        <h2 style="float: left">{{amountmt}}</h2>
                        <div style="padding: 15%;"><img src="%E6%8C%87%E7%BA%B9.png"
                                style="width: 70px;margin-top: 40%"></div>
                    </div>
                    <div id="ls">
                        <template v-for="(item, index) in itemsmt.slice().reverse()">
                            <div id="lsjl">{{item.created_at}}</div>
                            <div id="lsjl" style="color: red;">{{item.historical}}</div>

                        </template>

                    </div>

                </section>


            </div>


            <header>
                <div id="xsfw">
                    <label for="skill-level">范围：</label>
                    <select id="skill-level" name="skill-level">
                        <option value="yizhou">一周</option>
                        <option value="yiyue">一月</option>
                        <option value="yinian">一年</option>
                        <option value="quanbu">全部</option>
                    </select>
                    共收入：{{srsum}}共消费：{{zcsum}}
                </div>
                <canvas id="lineChartto" width="800" height="700"></canvas>

            </header>


        </div>
    </div>

    <script>
        fetch('https://v1.hitokoto.cn/?max_length=10')
            .then(response => response.json())
            .then(data => {
                console.log(data.hitokoto);
                document.getElementById("opText").innerHTML = data.hitokoto;
            })
        // 获取DOM元素
        const overlay = document.getElementById('overlay');
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden'; // 防止背景滚动

        let electricitys = [];
        let GSdata = [];
        let myChart = null;
        let myChartto = null;
        let vueInstance;
        window.zfb = 0.00;
        window.zfz = 0.00;
        window.wx = 0.00;
        window.mt = 0.00;
        window.sry = 0.00;
        window.platforms = '';
        // datars();
        new Vue({
            el: '#app',
            data: function () {
                return {
                    bl: [],
                    items: [],
                    itemsmt: [],
                    itemswx: [],
                    itemsz: [],
                    srys: [],
                    srysg: [],
                    sj: [],
                    je: [],
                    sr: [],
                    rsrs: [],
                    amount: 0.00,
                    amountmt: 0.00,
                    amountwx: 0.00,
                    currentPlatform: '',
                    currentAmount: '',
                    currentDueDate: '',
                    currentMinPayment: '',
                    modalTitle: '还款详情',
                    sry: 0.00,
                    rsr: '0.00',
                    l: '借款',
                    r: '还款',
                    times: 7,
                    srsum: 0.00,
                    zcsum: 0.00,
                    // items: JSON.parse(adb4),
                }
            },
            async created() {
                vueInstance = this;
                await this.fetchData();

                this.mrzc();
                //this.timesdy();

            },
            methods: {
                mrzc() {
                    
                    //每日支出


                    //console.log("每日支出");

                    // console.log(this.itemsmt);
                    //console.log(this.itemsmt);
                    //console.log(this.srys);
                    for (let a = 0; a < this.srys.length; a++) {
                        //console.log(this.srys[a].historical.substring(0, 2));
                        if (this.srys[a].historical.substring(0, 2) == '支出') {
                            this.itemsz[this.itemsz.length] = { ...this.srys[a] };
                        }
                    };
                    for (let a = 0; a < this.itemswx.length; a++) {
                        if (this.itemswx[a].historical.substring(0, 2) == '借款') {
                            this.itemsz[this.itemsz.length] = { ...this.itemswx[a] };
                        }
                    };
                    for (let a = 0; a < this.itemsmt.length; a++) {
                        if (this.itemsmt[a].historical.substring(0, 2) == '借款') {
                            this.itemsz[this.itemsz.length] = { ...this.itemsmt[a] };
                        }
                    };

                    for (let a = 0; a < this.items.length; a++) {
                        if (this.items[a].historical.substring(0, 2) == '借款') {
                            this.itemsz[this.itemsz.length] = { ...this.items[a] };
                        }
                    };
                    //console.log(this.itemsz);
                    for (let a = 0; a < this.itemsz.length; a++) {
                        if (typeof this.itemsz[a].historical === 'string') {
                            this.itemsz[a].historical = this.itemsz[a].historical.match(/\d+\.\d+|\d+/g);

                        }
                    }

                    for (let a = 0; a < this.itemsz.length; a++) {
                        for (let b = a + 1; b < this.itemsz.length; b++) {
                            if (this.itemsz[a].created_at?.substring(0, 10) === this.itemsz[b].created_at?.substring(0, 10)) {
                                this.itemsz[a].historical = (parseFloat(this.itemsz[a].historical) + parseFloat(this.itemsz[b].historical)).toFixed(2);
                                this.itemsz.splice(b, 1);
                                b--;
                            }
                        }
                    };

                    // console.log(this.itemsz);

                    // 获取DOM元素
                    const selectElement = document.getElementById('skill-level');
                    // 添加事件监听器

                    selectElement.addEventListener('change', () => {

                        const selectedValue = event.target.value;
                        //console.log(selectedValue);

                        if (selectedValue) {
                            // 根据选择显示不同信息
                            switch (selectedValue) {
                                case 'yizhou':
                                    this.times = 7;
                                    this.timesdy();
                                    console.log('周触发');
                                    break;
                                case 'yiyue':
                                    this.times = 30;
                                    this.timesdy();

                                    console.log('月触发');
                                    break;
                                case 'yinian':
                                    this.times = 365;
                                    this.timesdy();
                                    console.log('年触发');
                                    break;
                                case 'quanbu':
                                    this.times = this.itemsz.length;
                                    console.log('全部触发');
                                    console.log(this.times);
                                    this.timesdy();

                                    break;
                                default:
                                    message = '';
                            }


                        }

                    });





                    this.timesdy();


                },
                timesdy() {
                    //清空图表数据
                    this.sj = []
                    this.je = []
                    this.sr = []
                    //对日期进行重新排序（倒序）
                    this.itemsz.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
                    //console.log(this.itemsz);
                    //判断所有数据是否比设定值小，判断成功则修改为显示全部数据
                    if (this.itemsz.length < this.times) {
                        this.times = this.itemsz.length;
                    }
                    //对时间和金额进行分变量提取
                    for (let a = 1; a <= this.times; a++) {
                        this.sj[a - 1] = this.itemsz[this.itemsz.length - a].created_at.substring(5, 10);
                        this.je[a - 1] = this.itemsz[this.itemsz.length - a].historical;
                    }
                    for (let a = 0; a < this.sj.length; a++) {
                        for (let b = 0; b < this.rsrs.length; b++) {
                            if (this.sj[a] === this.rsrs[b].created_at.substring(5, 10)) {
                                if (this.rsrs[b].historical.substring(0, 2) == "收入") {
                                    this.sr[a] = (Number(this.sr[a]) || 0) + Number(this.rsrs[b].historical.substring(2, 10));
                                }
                            }
                        }


                    }
                    //console.log(this.sr);
                    //console.log(this.rsrs);
                    // console.log(this.sj);
                    //console.log(this.je);
                    //将je中的所有数字都转换为数字类型
                    const result = this.je.map(item => {
                        if (Array.isArray(item)) {
                            // 如果数组有值，取第一个元素转换；如果没有值，返回0或NaN
                            return item.length > 0 ? Number(item[0]) : 0;
                        }
                        return Number(item);
                    });
                    // console.log(result);
                    //计算收入合计
                    const sum = this.sr.reduce((total, current) => {
                        // 将非数字值转为0
                        return total + (Number(current) || 0);
                    }, 0);
                    this.srsum = Number(sum.toFixed(2));
                    //计算支出合计
                    const sums = result.reduce((total, current) => {
                        // 将非数字值转为0
                        return total + (Number(current) || 0);
                    }, 0);
                    this.zcsum = Number(sums.toFixed(2));
                    //console.log(sum); // 529.2
                    // this.sj.reverse();
                    //this.je.reverse();
                    //判断图表是否已存在，存在则清空
                    if (myChartto) {
                        myChartto.destroy();
                        myChartto = null;
                    }
                    const data = this.itemsz
                    const ctx = document.getElementById('lineChart');
                    const ctxto = document.getElementById('lineChartto');
                    // 如果你想要水平柱状图（横向）
                    myChartto = new Chart(ctxto, {
                        type: 'bar',
                        data: {
                            labels: this.sj,
                            datasets: [
                                {
                                    label: '每日消费',
                                    data: result,
                                    backgroundColor: 'rgba(75, 192, 192, 0.8)', // 青色系
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1,
                                },
                                {
                                    label: '每日收入',
                                    data: this.sr, // 收入数据，假设有 this.sr 数组

                                    backgroundColor: 'rgba(255, 51, 153, 0.8)',
                                    borderColor: 'rgb(255, 51, 153)',
                                    borderWidth: 1,

                                }
                            ]
                        },
                        options: {
                            indexAxis: 'y', // 设置为 'y' 就是水平柱状图
                            responsive: true,
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                    }
                                }
                            }
                        }
                    });

                },
                SJ() {
                    window.lx = '借款'
                    document.getElementById('input').style.display = 'block';
                    document.getElementById('containers').style.marginTop = '20px';
                    document.getElementById('containers').style.display = 'none';
                    document.getElementById('gd').style.marginLeft = '0%';
                    document.getElementById('L').style.color = '#FFFF';
                    document.getElementById('R').style.color = '#000000';

                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth' // 可选，使滚动平滑
                    });
                },
                DN() {
                    window.lx = '还款'
                    document.getElementById('input').style.display = 'none';
                    document.getElementById('containers').style.marginTop = '60px';
                    document.getElementById('containers').style.display = 'block';
                    document.getElementById('gd').style.marginLeft = '50%';
                    document.getElementById('L').style.color = '#000000';
                    document.getElementById('R').style.color = '#FFFF';


                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth' // 可选，使滚动平滑

                    });

                },
                showModal(platform) {
                    platforms = platform;

                    // 设置当前平台数据
                    this.currentPlatform = this.getPlatformName(platform);

                    // 根据平台设置相应的数据
                    if (platform === 'alipay') {
                        this.currentAmount = this.amount;
                        this.l = '借款';
                        this.r = '还款';
                    } else if (platform === 'wechat') {
                        this.currentAmount = this.amountwx;
                        this.l = '借款';
                        this.r = '还款';
                    } else if (platform === 'meituan') {
                        this.currentAmount = this.amountmt;
                        this.l = '借款';
                        this.r = '还款';
                    }
                    else if (platform === 'sry') {
                        this.currentAmount = this.amountmt;
                        this.l = '提现';
                        this.r = '入账';

                    }
                    if (window.lx == '借款') {
                        document.getElementById('input').style.display = 'block';
                        document.getElementById('containers').style.marginTop = '20px';
                        document.getElementById('containers').style.display = 'none';
                        document.getElementById('gd').style.marginLeft = '0%';
                        document.getElementById('L').style.color = '#FFFF';
                        document.getElementById('R').style.color = '#000000';
                    } else {
                        document.getElementById('input').style.display = 'none';
                        document.getElementById('containers').style.marginTop = '60px';
                        document.getElementById('containers').style.display = 'block';
                        document.getElementById('gd').style.marginLeft = '50%';
                        document.getElementById('L').style.color = '#000000';
                        document.getElementById('R').style.color = '#FFFF';

                    }

                    // 更新模态框标题
                    this.modalTitle = `${this.currentPlatform}`;

                    // 显示模态框
                    $('#myModal').modal('show');


                },

                getPlatformName(platform) {
                    switch (platform) {
                        case 'alipay': return '支付宝花呗';
                        case 'wechat': return '微信分付';
                        case 'meituan': return '美团月付';
                        case 'sry': return '今日收入';
                        default: return '未知平台';
                    }
                },
                async fetchData() {
                    
                    try {
                        let sryData, historicalData, mtData, wxData, blData;
                        let hasNetworkError = false;

                        try {
                            // 使用 Promise.all 并行执行所有请求
                            const [sryResponse, historicalResponse, mtResponse, wxResponse, blResponse] = await Promise.all([
                                fetch('https://api.codetabs.com/v1/proxy/?quest=http://1z624868f2.wicp.vip/api/users/sry'),
                                fetch('https://api.codetabs.com/v1/proxy/?quest=http://1z624868f2.wicp.vip/api/users/historical'),
                                fetch('https://api.codetabs.com/v1/proxy/?quest=http://1z624868f2.wicp.vip/api/users/mt'),
                                fetch('https://api.codetabs.com/v1/proxy/?quest=http://1z624868f2.wicp.vip/api/users/wx'),
                                fetch('https://api.codetabs.com/v1/proxy/?quest=http://1z624868f2.wicp.vip/api/users/bl')
                            ]);

                            // 检查所有响应是否成功
                            if (!sryResponse.ok || !historicalResponse.ok || !mtResponse.ok || !wxResponse.ok || !blResponse.ok) {
                                throw new Error('部分请求失败');
                            }

                            // 并行解析所有 JSON 数据
                            [sryData, historicalData, mtData, wxData, blData] = await Promise.all([
                                sryResponse.json(),
                                historicalResponse.json(),
                                mtResponse.json(),
                                wxResponse.json(),
                                blResponse.json()
                            ]);

                            // 网络请求成功，将最新数据存储到 localStorage
                            localStorage.setItem('srysData', JSON.stringify(sryData));
                            localStorage.setItem('historicalData', JSON.stringify(historicalData));
                            localStorage.setItem('mtData', JSON.stringify(mtData));
                            localStorage.setItem('wxData', JSON.stringify(wxData));
                            localStorage.setItem('blData', JSON.stringify(blData));

                            if (localStorage.getItem('srysDB') != null) {
                                let storedSryData = JSON.parse(localStorage.getItem('srysDB'));
                                let storedHistoricalData = JSON.parse(localStorage.getItem('historicalDB'));
                                let storedMtData = JSON.parse(localStorage.getItem('mtDB'));
                                let storedWxData = JSON.parse(localStorage.getItem('wxDB'));
                                let lb = [storedSryData, storedHistoricalData, storedMtData, storedWxData]
                                let cs = ['srys', 'historical', 'mt', 'wx']

                                for (var b = 0; b < lb.length; b++) {
                                    let bl = lb[b];
                                    for (let a = 0; a < bl.length; a++) {
                                        axios.post('http://1z624868f2.wicp.vip/api/users/' + cs[b], {
                                            historical: bl[a].historical,
                                            amount: bl[a].amount
                                        })
                                            .then(response => {
                                                console.log('所有数据添加成功')
                                            })
                                            .catch(error => {
                                                console.log(bl[a].historical)
                                            })

                                    }

                                }
                                ['srysDB', 'historicalDB', 'mtDB', 'wxDB',].forEach(key => {
                                    localStorage.removeItem(key);
                                    console.log(`已删除: ${key}`);
                                });

                            }



                            //let storedBlData = localStorage.getItem('blData');
                            // let lb = [storedSryData, storedHistoricalData, storedMtData, storedWxData, storedBlData]
                            // console.log(storedSryData.length);
                            // for (var b = 0; b < lb.length; b++) {
                            //     for (let a = 0; a < lb[b].length; a++) {
                            //         let bl =lb[b];
                            //         if (bl[a].hasOwnProperty('id')) {
                            //             console.log('id存在:', lb[b][a]);
                            //         } else {
                            //             console.log('id不存在或对象不存在');
                            //         }
                            //     }
                            // }
                        } catch (networkError) {
                            console.warn('网络请求失败，尝试从本地缓存加载数据:', networkError);
                            hasNetworkError = true;

                            // 从 localStorage 获取缓存数据'
                            const storedSryData = localStorage.getItem('srysData');
                            const storedHistoricalData = localStorage.getItem('historicalData');
                            const storedMtData = localStorage.getItem('mtData');
                            const storedWxData = localStorage.getItem('wxData');
                            const storedBlData = localStorage.getItem('blData');

                            // 检查是否有缓存数据
                            if (!storedSryData || !storedHistoricalData || !storedMtData || !storedWxData || !storedBlData) {
                                throw new Error('网络请求失败且本地无缓存数据');
                            }

                            // 解析缓存数据
                            sryData = JSON.parse(storedSryData);
                            historicalData = JSON.parse(storedHistoricalData);
                            mtData = JSON.parse(storedMtData);
                            wxData = JSON.parse(storedWxData);
                            blData = JSON.parse(storedBlData);

                            // 可以在这里添加一个标记，表明使用的是缓存数据
                            console.log('正在使用本地缓存数据');
                        }

                        // console.log(sryData);
                        // console.log(historicalData);
                        // console.log(mtData);
                        // console.log(wxData);
                        // console.log(blData);

                        // 处理bl数据
                        this.bl = blData;

                        // 处理收入源数据
                        this.srys = sryData;
                        this.rsrs = sryData;
                        for (let a = 0; a < sryData.length; a++) {
                            this.srys[a].created_at = this.time(sryData[a].created_at);
                            this.srys[a].historical = sryData[a].historical.replace("借款", "支出").replace("还款", "收入");
                        }
                        this.sry = sryData[sryData.length - 1].amount;
                        window.sry = sryData[sryData.length - 1].amount;

                        // 获取当前日期
                        const today = new Date();
                        const dateString = today.getFullYear() + '/' +
                            String(today.getMonth() + 1).padStart(2, '0') + '/' +
                            String(today.getDate()).padStart(2, '0');
                        this.rsr = 0;
                        for (let a = 0; a < this.srys.length; a++) {
                            if (dateString === this.srys[a].created_at?.substring(0, 10)) {
                                if (this.srys[a].historical.substring(0, 2) == '收入') {
                                    this.rsr = (parseFloat(this.rsr) + parseFloat(this.srys[a].historical.match(/\d+\.\d+|\d+/g))).toFixed(2);
                                }
                            }
                        }
                        if (this.rsr === 0) {
                            this.rsr = '请自律';
                        }

                        // 处理支付宝数据
                        this.items = historicalData;
                        for (let a = 0; a < historicalData.length; a++) {
                            this.items[a].created_at = this.time(historicalData[a].created_at);
                        }
                        this.amount = historicalData[historicalData.length - 1].amount;
                        window.zfb = historicalData[historicalData.length - 1].amount;

                        // 处理美团数据
                        this.itemsmt = mtData;
                        for (let a = 0; a < mtData.length; a++) {
                            this.itemsmt[a].created_at = this.time(mtData[a].created_at);
                        }
                        this.amountmt = mtData[mtData.length - 1].amount;
                        window.mt = mtData[mtData.length - 1].amount;

                        // 处理微信数据
                        this.itemswx = wxData;
                        for (let a = 0; a < wxData.length; a++) {
                            this.itemswx[a].created_at = this.time(wxData[a].created_at);
                        }
                        this.amountwx = wxData[wxData.length - 1].amount;
                        window.wx = wxData[wxData.length - 1].amount;

                        // 移除模糊效果和覆盖层
                        const elements = document.querySelectorAll('#container');
                        elements.forEach(element => {
                            element.style.filter = 'blur(0px)';
                        });
                        document.getElementById('overlay').classList.remove('active');
                        document.body.style.overflow = '';

                        // 如果使用的是缓存数据，可以给用户一个提示
                        if (hasNetworkError) {
                            // 可以在这里添加一个提示，比如显示一个消息告诉用户使用的是缓存数据
                            console.log('数据加载完成（使用缓存数据）');
                            // 可选：显示一个提示给用户
                            // this.showMessage('网络连接失败，显示的是上次保存的数据', 'warning');
                        } else {
                            console.log('所有数据加载完成（最新数据）');
                        }

                        zfz = parseFloat((parseFloat(this.amount || 0) + parseFloat(this.amountmt || 0) + parseFloat(this.amountwx ||
                            0) + 3000).toFixed(2));
                        console.log(zfz);
                        axios.post('http://1z624868f2.wicp.vip/broadcast', {
                            amount: zfz,
                            sry: this.sry
                            
                        },
                        
                    )

                    } catch (error) {
                        console.error('数据加载失败:', error);

                        // 可以在这里添加一个更友好的错误提示
                        if (error.message === '网络请求失败且本地无缓存数据') {
                            console.error('无网络连接且无本地缓存数据，请检查网络连接');
                            // 显示更详细的错误提示给用户
                            // this.showMessage('无法加载数据，请检查网络连接', 'error');
                        }

                        throw error; // 重新抛出错误以便外部捕获
                    }

                },
                //时间格式化
                time(times) {
                    const utcString = times;
                    const utcDate = new Date(utcString);

                    const formatter = new Intl.DateTimeFormat('zh-CN', {
                        timeZone: 'Asia/Shanghai',
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    });

                    return formatter.format(utcDate);
                }


            }




        });
        // let fu = '';
        // let mol = 0;
        // mo();
        //电量显示与格式化
        // function datars() {

        //     fetch('/api/users')
        //         .then(response => response.json())
        //         .then(data => {
        //             //console.log(data);
        //             let o = 0;
        //             const datas = data;
        //             for (let i = 0; i < data.length; i++) {

        //                 datas[i].created_at = time(datas[i].created_at)
        //                 electricitys[i] = data[i].electricity
        //                 const hour = datas[i].created_at.split(" ")[1].split(":")[0];
        //                 if (i > 0) {
        //                     if (hour != datas[i - 1].created_at.split(" ")[1].split(":")[0]) {

        //                         GSdata[o] = datas[i];
        //                         o++;
        //                     }
        //                 } else {

        //                     GSdata[o] = datas[i];
        //                     o++;

        //                 }

        //             }

        //             function time(times) {
        //                 const utcString = times;
        //                 const utcDate = new Date(utcString);

        //                 const formatter = new Intl.DateTimeFormat('zh-CN', {
        //                     timeZone: 'Asia/Shanghai',
        //                     year: 'numeric',
        //                     month: '2-digit',
        //                     day: '2-digit',
        //                     hour: '2-digit',
        //                     minute: '2-digit',
        //                     second: '2-digit',
        //                     hour12: false
        //                 });

        //                 return formatter.format(utcDate);
        //             };
        //             document.getElementById('tim').innerText = time(data[0].created_at) + '——' + Math.trunc(data[0].electricity) + '%';
        //             document.getElementById('tim2').innerText = time(data[99].created_at) + '——' + Math.trunc(data[99].electricity) + '%';
        //             function updateBattery() {
        //                 const batteryElement = document.getElementById('batteryLevel');
        //                 const percentageElement = document.getElementById('batteryPercentage');

        //                 // 更新进度条宽度
        //                 batteryElement.style.width = Math.trunc(data[0].electricity) + '%';
        //                 percentageElement.textContent = Math.trunc(data[0].electricity) + '%';
        //                 document.getElementById('batteryLevel2').style.width = Math.trunc(data[99].electricity) + '%';
        //                 document.getElementById('batteryPercentage2').textContent = Math.trunc(data[99].electricity) + '%';




        //                 // 根据电量改变颜色和状态
        //                 if (batteryLevel > 70) {
        //                     batteryElement.style.background = 'linear-gradient(to right, #4CAF50, #8BC34A)';
        //                 } else if (batteryLevel > 30) {
        //                     batteryElement.style.background = 'linear-gradient(to right, #FFC107, #FFEB3B)';
        //                 } else if (batteryLevel > 10) {
        //                     batteryElement.style.background = 'linear-gradient(to right, #FF9800, #FFC107)';
        //                 } else {
        //                     batteryElement.style.background = 'linear-gradient(to right, #F44336, #FF9800)';
        //                 }


        //             }

        //             // 初始化
        //             updateBattery();

        //         })
        // }

        // function mo() {



        // };


    </script>
</body>

</html>